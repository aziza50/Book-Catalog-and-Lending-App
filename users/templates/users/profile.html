{% extends "catalog/base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <h1 class="mb-0 ms-4">My Account</h1>
  <hr class="mt-0" style="border: 1px solid gray; width: 100%;">

  <div class="row">
    <!-- Left Side: Profile and Upload Form -->
    <div class="col-md-6">
      <div class="leftSide">
        {% if user.userprofile.profile_pic %}
          <img src="{{ user.userprofile.profile_pic.url }}" alt="Profile Picture" class="img-fluid rounded" style="width:200px;height:auto;">
        {% else %}
          <img src="{% static 'users/images/profile.png' %}" alt="Default Profile Picture" class="img-fluid rounded" style="width:200px;height:auto;">
        {% endif %}

        {% if is_librarian %}
          <p>You are a Librarian!</p>
        {% elif is_patron %}
          <p>You are a Patron!</p>
        {% endif %}

        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" class="btn btn-primary">Upload Profile Picture</button>
        </form>
      </div>
    </div>

    <!-- Right Side: Requests and Collections -->
    <div class="col-md-6">
      <div class="rightSide">
        <!-- Requests Section -->
        <div class="mb-4">
          <h3>Requests</h3>
          <ul class="list-group">
            {% if is_patron %}
              {% for request in pending_requests %}
                <li class="list-group-item">
                  Request for "{{ request.book.title }}" - Status: {{ request.status }}
                </li>
              {% empty %}
                <li class="list-group-item">No pending requests.</li>
              {% endfor %}
            {% elif is_librarian %}
              {% for request in incoming_requests %}
                <li class="list-group-item">
                  Request from {{ request.patron.username }} for "{{ request.book.title }}" - Status: {{ request.status }} - Pick-up Time: {{request.pickup_datetime}}
                </li>
              {% empty %}
                <li class="list-group-item">No incoming requests.</li>
              {% endfor %}
            {% endif %}
          </ul>
        </div>

        <!-- Collections Section -->
        <div class="mb-4">
          <h3>My Collections</h3>
          <ul class="list-group">
            {% for collection in collections %}
              <li class="list-group-item">
                {{ collection.title }}
              </li>
            {% empty %}
              <li class="list-group-item">No collections found.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
